<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" font-family="Arial, sans-serif">
  <defs>
    <linearGradient id="headerGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#1a73e8"/>
      <stop offset="100%" style="stop-color:#4285f4"/>
    </linearGradient>
    <linearGradient id="autoGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e6f4ea"/>
      <stop offset="100%" style="stop-color:#ceead6"/>
    </linearGradient>
    <linearGradient id="eventGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fef7e0"/>
      <stop offset="100%" style="stop-color:#feefc3"/>
    </linearGradient>
    <linearGradient id="ondemandGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e8f0fe"/>
      <stop offset="100%" style="stop-color:#d2e3fc"/>
    </linearGradient>
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#5f6368"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34a853"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#fbbc04"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1a73e8"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="900" fill="#f8f9fa"/>
  
  <!-- Title Header -->
  <rect x="0" y="0" width="1200" height="70" fill="url(#headerGrad)"/>
  <text x="600" y="32" text-anchor="middle" fill="white" font-size="24" font-weight="bold">GCP Cost Monitoring Agent — Technical Summary</text>
  <text x="600" y="55" text-anchor="middle" fill="#c2e0ff" font-size="14">Triggers, Schedules &amp; Data Collection | Stateless MCP Server (Cloud Run) → GCP Built-in APIs</text>
  
  <!-- Three Data Collection Modes -->
  <text x="600" y="100" text-anchor="middle" font-weight="bold" font-size="16" fill="#5f6368">THREE DATA COLLECTION MODES</text>
  
  <!-- Mode 1: Automatic (GCP-Managed) -->
  <rect x="50" y="120" width="350" height="260" rx="10" fill="url(#autoGrad)" stroke="#34a853" stroke-width="2" filter="url(#shadow)"/>
  <rect x="50" y="120" width="350" height="35" rx="10" fill="#34a853"/>
  <rect x="50" y="145" width="350" height="10" fill="#34a853"/>
  <text x="225" y="145" text-anchor="middle" fill="white" font-weight="bold" font-size="14">AUTOMATIC (GCP-Managed)</text>
  <text x="225" y="175" text-anchor="middle" fill="#34a853" font-size="11">No action required from us</text>
  
  <!-- Automatic items -->
  <rect x="70" y="190" width="310" height="40" rx="4" fill="white" stroke="#34a853" stroke-width="1"/>
  <text x="85" y="210" font-size="11" fill="#5f6368"><tspan font-weight="bold">Billing Export</tspan> → BigQuery</text>
  <text x="85" y="225" font-size="9" fill="#999">Daily batch, 24-48h delay</text>
  
  <rect x="70" y="240" width="310" height="40" rx="4" fill="white" stroke="#34a853" stroke-width="1"/>
  <text x="85" y="260" font-size="11" fill="#5f6368"><tspan font-weight="bold">Budget Service</tspan> → Threshold Check</text>
  <text x="85" y="275" font-size="9" fill="#999">Continuous monitoring</text>
  
  <rect x="70" y="290" width="310" height="40" rx="4" fill="white" stroke="#34a853" stroke-width="1"/>
  <text x="85" y="310" font-size="11" fill="#5f6368"><tspan font-weight="bold">Recommender</tspan> → ML Analysis</text>
  <text x="85" y="325" font-size="9" fill="#999">Continuous (8+ day data needed)</text>
  
  <rect x="70" y="340" width="310" height="30" rx="4" fill="white" stroke="#34a853" stroke-width="1"/>
  <text x="85" y="360" font-size="11" fill="#5f6368"><tspan font-weight="bold">Asset Inventory</tspan> → Resource State</text>
  
  <!-- Mode 2: Event-Driven -->
  <rect x="425" y="120" width="350" height="260" rx="10" fill="url(#eventGrad)" stroke="#fbbc04" stroke-width="2" filter="url(#shadow)"/>
  <rect x="425" y="120" width="350" height="35" rx="10" fill="#fbbc04"/>
  <rect x="425" y="145" width="350" height="10" fill="#fbbc04"/>
  <text x="600" y="145" text-anchor="middle" fill="white" font-weight="bold" font-size="14">EVENT-DRIVEN (Pub/Sub)</text>
  <text x="600" y="175" text-anchor="middle" fill="#e37400" font-size="11">React via Cloud Function</text>
  
  <!-- Budget Alert Flow -->
  <rect x="445" y="190" width="310" height="55" rx="4" fill="white" stroke="#fbbc04" stroke-width="1"/>
  <text x="600" y="208" text-anchor="middle" font-weight="bold" font-size="11" fill="#5f6368">Budget Alert Flow</text>
  <text x="460" y="228" font-size="9" fill="#5f6368">Budget Alert → Pub/Sub → Cloud Function → Circuit Breaker</text>
  <text x="460" y="240" font-size="9" fill="#999">Latency: Near real-time (seconds)</text>
  
  <!-- Asset Change Flow -->
  <rect x="445" y="255" width="310" height="55" rx="4" fill="white" stroke="#fbbc04" stroke-width="1"/>
  <text x="600" y="273" text-anchor="middle" font-weight="bold" font-size="11" fill="#5f6368">Asset Change Flow</text>
  <text x="460" y="293" font-size="9" fill="#5f6368">Asset Change → Pub/Sub → Cloud Function → Cost Alert</text>
  <text x="460" y="305" font-size="9" fill="#999">Latency: Seconds to minutes</text>
  
  <!-- Actions -->
  <rect x="445" y="320" width="145" height="50" rx="4" fill="#fce8e6" stroke="#ea4335" stroke-width="1"/>
  <text x="517" y="340" text-anchor="middle" font-size="10" fill="#c5221f" font-weight="bold">Circuit Breaker</text>
  <text x="517" y="355" text-anchor="middle" font-size="9" fill="#5f6368">Stop/Scale/Alert</text>
  
  <rect x="600" y="320" width="155" height="50" rx="4" fill="#e8f0fe" stroke="#1a73e8" stroke-width="1"/>
  <text x="677" y="340" text-anchor="middle" font-size="10" fill="#1a73e8" font-weight="bold">Cost Alert</text>
  <text x="677" y="355" text-anchor="middle" font-size="9" fill="#5f6368">Slack/Email notify</text>
  
  <!-- Mode 3: On-Demand -->
  <rect x="800" y="120" width="350" height="260" rx="10" fill="url(#ondemandGrad)" stroke="#1a73e8" stroke-width="2" filter="url(#shadow)"/>
  <rect x="800" y="120" width="350" height="35" rx="10" fill="#1a73e8"/>
  <rect x="800" y="145" width="350" height="10" fill="#1a73e8"/>
  <text x="975" y="145" text-anchor="middle" fill="white" font-weight="bold" font-size="14">ON-DEMAND (User Query)</text>
  <text x="975" y="175" text-anchor="middle" fill="#1a73e8" font-size="11">Query APIs, return response</text>
  
  <!-- Query Flow -->
  <rect x="820" y="190" width="100" height="40" rx="20" fill="#202124"/>
  <text x="870" y="215" text-anchor="middle" fill="white" font-size="11">User</text>
  
  <path d="M920 210 L960 210" stroke="#1a73e8" stroke-width="2" marker-end="url(#arrowBlue)"/>
  
  <rect x="960" y="190" width="80" height="40" rx="4" fill="white" stroke="#1a73e8" stroke-width="2"/>
  <text x="1000" y="215" text-anchor="middle" font-size="10" fill="#1a73e8">MCP</text>
  
  <path d="M1000 230 L1000 260" stroke="#1a73e8" stroke-width="2" marker-end="url(#arrowBlue)"/>
  
  <rect x="930" y="260" width="140" height="40" rx="4" fill="white" stroke="#1a73e8" stroke-width="1"/>
  <text x="1000" y="285" text-anchor="middle" font-size="10" fill="#5f6368">Query GCP APIs</text>
  
  <path d="M1000 300 L1000 330" stroke="#1a73e8" stroke-width="2" marker-end="url(#arrowBlue)"/>
  
  <rect x="930" y="330" width="140" height="35" rx="4" fill="#e8f0fe" stroke="#1a73e8" stroke-width="1"/>
  <text x="1000" y="352" text-anchor="middle" font-size="10" fill="#1a73e8">Response</text>
  
  <text x="975" y="375" text-anchor="middle" font-size="9" fill="#999">Latency: 2-5 seconds typical</text>
  
  <!-- Data Freshness Table -->
  <rect x="50" y="400" width="550" height="180" rx="10" fill="white" stroke="#dadce0" stroke-width="1" filter="url(#shadow)"/>
  <text x="325" y="425" text-anchor="middle" font-weight="bold" font-size="14" fill="#5f6368">DATA FRESHNESS</text>
  
  <line x1="70" y1="440" x2="580" y2="440" stroke="#dadce0" stroke-width="1"/>
  <text x="150" y="455" text-anchor="middle" font-size="10" fill="#5f6368" font-weight="bold">Data Type</text>
  <text x="320" y="455" text-anchor="middle" font-size="10" fill="#5f6368" font-weight="bold">Freshness</text>
  <text x="480" y="455" text-anchor="middle" font-size="10" fill="#5f6368" font-weight="bold">Notes</text>
  <line x1="70" y1="465" x2="580" y2="465" stroke="#dadce0" stroke-width="1"/>
  
  <text x="150" y="485" text-anchor="middle" font-size="10" fill="#5f6368">Cost data (BigQuery)</text>
  <text x="320" y="485" text-anchor="middle" font-size="10" fill="#ea4335">24-48 hours</text>
  <text x="480" y="485" text-anchor="middle" font-size="10" fill="#999">GCP billing export delay</text>
  
  <text x="150" y="505" text-anchor="middle" font-size="10" fill="#5f6368">Budget status</text>
  <text x="320" y="505" text-anchor="middle" font-size="10" fill="#34a853">Real-time</text>
  <text x="480" y="505" text-anchor="middle" font-size="10" fill="#999">Current spend vs budget</text>
  
  <text x="150" y="525" text-anchor="middle" font-size="10" fill="#5f6368">Recommendations</text>
  <text x="320" y="525" text-anchor="middle" font-size="10" fill="#fbbc04">8+ days lag</text>
  <text x="480" y="525" text-anchor="middle" font-size="10" fill="#999">Needs usage history</text>
  
  <text x="150" y="545" text-anchor="middle" font-size="10" fill="#5f6368">Resource inventory</text>
  <text x="320" y="545" text-anchor="middle" font-size="10" fill="#34a853">Real-time</text>
  <text x="480" y="545" text-anchor="middle" font-size="10" fill="#999">Current state</text>
  
  <text x="150" y="565" text-anchor="middle" font-size="10" fill="#5f6368">Resource changes</text>
  <text x="320" y="565" text-anchor="middle" font-size="10" fill="#34a853">Real-time</text>
  <text x="480" y="565" text-anchor="middle" font-size="10" fill="#999">Via Asset Feed</text>
  
  <!-- 6 Core Components -->
  <rect x="620" y="400" width="530" height="180" rx="10" fill="white" stroke="#dadce0" stroke-width="1" filter="url(#shadow)"/>
  <text x="885" y="425" text-anchor="middle" font-weight="bold" font-size="14" fill="#5f6368">6 CORE COMPONENTS</text>
  
  <rect x="640" y="440" width="155" height="55" rx="4" fill="#e8f0fe" stroke="#4285f4" stroke-width="1"/>
  <text x="717" y="460" text-anchor="middle" font-size="10" fill="#4285f4" font-weight="bold">1. Org Scanner</text>
  <text x="717" y="475" text-anchor="middle" font-size="9" fill="#5f6368">Projects &amp; services</text>
  <text x="717" y="488" text-anchor="middle" font-size="8" fill="#999">On-demand</text>
  
  <rect x="805" y="440" width="155" height="55" rx="4" fill="#fce8e6" stroke="#ea4335" stroke-width="1"/>
  <text x="882" y="460" text-anchor="middle" font-size="10" fill="#ea4335" font-weight="bold">2. Circuit Breaker</text>
  <text x="882" y="475" text-anchor="middle" font-size="9" fill="#5f6368">Auto cost control</text>
  <text x="882" y="488" text-anchor="middle" font-size="8" fill="#999">Event-driven</text>
  
  <rect x="970" y="440" width="155" height="55" rx="4" fill="#fef7e0" stroke="#fbbc04" stroke-width="1"/>
  <text x="1047" y="460" text-anchor="middle" font-size="10" fill="#e37400" font-weight="bold">3. Budget Monitor</text>
  <text x="1047" y="475" text-anchor="middle" font-size="9" fill="#5f6368">Multi-threshold alerts</text>
  <text x="1047" y="488" text-anchor="middle" font-size="8" fill="#999">GCP-managed</text>
  
  <rect x="640" y="505" width="155" height="55" rx="4" fill="#e6f4ea" stroke="#34a853" stroke-width="1"/>
  <text x="717" y="525" text-anchor="middle" font-size="10" fill="#34a853" font-weight="bold">4. Real-time Tracker</text>
  <text x="717" y="540" text-anchor="middle" font-size="9" fill="#5f6368">Expensive resources</text>
  <text x="717" y="553" text-anchor="middle" font-size="8" fill="#999">Event-driven</text>
  
  <rect x="805" y="505" width="155" height="55" rx="4" fill="#f3e8fd" stroke="#9334e6" stroke-width="1"/>
  <text x="882" y="525" text-anchor="middle" font-size="10" fill="#9334e6" font-weight="bold">5. ML Recommendations</text>
  <text x="882" y="540" text-anchor="middle" font-size="9" fill="#5f6368">GCP optimization</text>
  <text x="882" y="553" text-anchor="middle" font-size="8" fill="#999">On-demand</text>
  
  <rect x="970" y="505" width="155" height="55" rx="4" fill="#fce4ec" stroke="#f538a0" stroke-width="1"/>
  <text x="1047" y="525" text-anchor="middle" font-size="10" fill="#f538a0" font-weight="bold">6. Anomaly Detector</text>
  <text x="1047" y="540" text-anchor="middle" font-size="9" fill="#5f6368">Statistical analysis</text>
  <text x="1047" y="553" text-anchor="middle" font-size="8" fill="#999">On-demand</text>
  
  <!-- Circuit Breaker Thresholds -->
  <rect x="50" y="600" width="550" height="150" rx="10" fill="white" stroke="#ea4335" stroke-width="2" filter="url(#shadow)"/>
  <text x="325" y="625" text-anchor="middle" font-weight="bold" font-size="14" fill="#ea4335">CIRCUIT BREAKER THRESHOLDS (Two-Level)</text>
  
  <!-- Per-Service -->
  <rect x="70" y="640" width="250" height="95" rx="4" fill="#fce8e6"/>
  <text x="195" y="658" text-anchor="middle" font-weight="bold" font-size="11" fill="#c5221f">Per-Service Examples</text>
  <text x="85" y="678" font-size="10" fill="#5f6368">Vertex AI: $500→$2.5K (CRIT)</text>
  <text x="85" y="695" font-size="10" fill="#5f6368">Compute: $300→$1.5K (CRIT)</text>
  <text x="85" y="712" font-size="10" fill="#5f6368">BigQuery: $200→$1K (CRIT)</text>
  
  <!-- Overall -->
  <rect x="335" y="640" width="250" height="95" rx="4" fill="#fef7e0"/>
  <text x="460" y="658" text-anchor="middle" font-weight="bold" font-size="11" fill="#e37400">Overall (Safety Net)</text>
  <text x="350" y="678" font-size="10" fill="#5f6368">WARNING: $1,000/day</text>
  <text x="350" y="695" font-size="10" fill="#5f6368">ELEVATED: $2,500/day</text>
  <text x="350" y="712" font-size="10" fill="#c5221f">CRITICAL: $5K | EMERGENCY: $10K</text>
  
  <!-- APIs Used -->
  <rect x="620" y="600" width="530" height="150" rx="10" fill="white" stroke="#1a73e8" stroke-width="2" filter="url(#shadow)"/>
  <text x="885" y="625" text-anchor="middle" font-weight="bold" font-size="14" fill="#1a73e8">8 GCP APIs USED</text>
  
  <text x="700" y="650" font-size="10" fill="#5f6368">• Resource Manager v3</text>
  <text x="700" y="668" font-size="10" fill="#5f6368">• Service Usage</text>
  <text x="700" y="686" font-size="10" fill="#5f6368">• Budget API</text>
  <text x="700" y="704" font-size="10" fill="#5f6368">• Cloud Asset Inventory</text>
  
  <text x="920" y="650" font-size="10" fill="#5f6368">• Recommender API</text>
  <text x="920" y="668" font-size="10" fill="#5f6368">• BigQuery</text>
  <text x="920" y="686" font-size="10" fill="#5f6368">• Cloud Monitoring</text>
  <text x="920" y="704" font-size="10" fill="#5f6368">• Pub/Sub</text>
  
  <text x="885" y="735" text-anchor="middle" font-size="10" fill="#999">+ Compute Engine API for stop/start actions</text>
  
  <!-- What We Store vs GCP -->
  <rect x="50" y="770" width="1100" height="110" rx="10" fill="white" stroke="#dadce0" stroke-width="1" filter="url(#shadow)"/>
  <text x="600" y="795" text-anchor="middle" font-weight="bold" font-size="14" fill="#5f6368">WHAT WE STORE vs WHAT GCP STORES</text>
  
  <rect x="70" y="810" width="500" height="55" rx="4" fill="#e6f4ea"/>
  <text x="320" y="830" text-anchor="middle" font-weight="bold" font-size="11" fill="#34a853">GCP STORES (Everything)</text>
  <text x="85" y="850" font-size="10" fill="#5f6368">Cost history (BigQuery) | Budget config | Recommendations | Resource state | Audit logs</text>
  
  <rect x="590" y="810" width="540" height="55" rx="4" fill="#fff3e0"/>
  <text x="860" y="830" text-anchor="middle" font-weight="bold" font-size="11" fill="#e65100">WE STORE (Almost Nothing)</text>
  <text x="605" y="850" font-size="10" fill="#5f6368">Circuit breaker state (Firestore, optional) | Conversation context (in-memory, per request)</text>
  
  <!-- Footer -->
  <text x="600" y="895" text-anchor="middle" font-size="10" fill="#9aa0a6">Technical Summary v1.1 — February 2025 | Infrastructure: $20-80/month | Target: SMBs with $50K-$500K monthly spend</text>
</svg>
