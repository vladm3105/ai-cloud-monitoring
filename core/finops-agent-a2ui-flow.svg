<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900">
  <defs>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a202c"/>
      <stop offset="100%" style="stop-color:#2d3748"/>
    </linearGradient>
    <linearGradient id="userGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#38a169"/>
      <stop offset="100%" style="stop-color:#276749"/>
    </linearGradient>
    <linearGradient id="agentGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#805ad5"/>
      <stop offset="100%" style="stop-color:#553c9a"/>
    </linearGradient>
    <linearGradient id="mcpGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3182ce"/>
      <stop offset="100%" style="stop-color:#2b6cb0"/>
    </linearGradient>
    <linearGradient id="uiGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ed8936"/>
      <stop offset="100%" style="stop-color:#c05621"/>
    </linearGradient>
    
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#a0aec0"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#48bb78"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9f7aea"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#63b3ed"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ed8936"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="900" fill="url(#bgGrad)"/>
  
  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="24" font-weight="bold">AG-UI / A2UI Event Flow</text>
  <text x="600" y="65" text-anchor="middle" fill="#a0aec0" font-family="Arial, sans-serif" font-size="14">Real-time Agent-to-UI Communication Protocol</text>
  
  <!-- Swimlanes -->
  <g id="swimlanes">
    <!-- User Lane -->
    <rect x="50" y="90" width="180" height="780" rx="8" fill="#276749" fill-opacity="0.2" stroke="#48bb78" stroke-width="2"/>
    <text x="140" y="115" text-anchor="middle" fill="#48bb78" font-family="Arial, sans-serif" font-size="14" font-weight="bold">üë§ USER</text>
    <text x="140" y="132" text-anchor="middle" fill="#68d391" font-family="Arial, sans-serif" font-size="10">CopilotKit UI</text>
    
    <!-- AG-UI Server Lane -->
    <rect x="260" y="90" width="180" height="780" rx="8" fill="#2d3748" fill-opacity="0.5" stroke="#718096" stroke-width="2"/>
    <text x="350" y="115" text-anchor="middle" fill="#a0aec0" font-family="Arial, sans-serif" font-size="14" font-weight="bold">üñ•Ô∏è AG-UI SERVER</text>
    <text x="350" y="132" text-anchor="middle" fill="#718096" font-family="Arial, sans-serif" font-size="10">FastAPI + SSE</text>
    
    <!-- Coordinator Agent Lane -->
    <rect x="470" y="90" width="180" height="780" rx="8" fill="#553c9a" fill-opacity="0.2" stroke="#9f7aea" stroke-width="2"/>
    <text x="560" y="115" text-anchor="middle" fill="#b794f4" font-family="Arial, sans-serif" font-size="14" font-weight="bold">üß† COORDINATOR</text>
    <text x="560" y="132" text-anchor="middle" fill="#d6bcfa" font-family="Arial, sans-serif" font-size="10">Google ADK</text>
    
    <!-- Specialist Agents Lane -->
    <rect x="680" y="90" width="180" height="780" rx="8" fill="#553c9a" fill-opacity="0.15" stroke="#805ad5" stroke-width="2"/>
    <text x="770" y="115" text-anchor="middle" fill="#9f7aea" font-family="Arial, sans-serif" font-size="14" font-weight="bold">ü§ñ SPECIALISTS</text>
    <text x="770" y="132" text-anchor="middle" fill="#b794f4" font-family="Arial, sans-serif" font-size="10">Cost, Optimization...</text>
    
    <!-- MCP Servers Lane -->
    <rect x="890" y="90" width="180" height="780" rx="8" fill="#2b6cb0" fill-opacity="0.2" stroke="#63b3ed" stroke-width="2"/>
    <text x="980" y="115" text-anchor="middle" fill="#90cdf4" font-family="Arial, sans-serif" font-size="14" font-weight="bold">‚öôÔ∏è MCP SERVERS</text>
    <text x="980" y="132" text-anchor="middle" fill="#bee3f8" font-family="Arial, sans-serif" font-size="10">AWS, Azure, GCP</text>
  </g>
  
  <!-- Event Flow -->
  <g id="event-flow">
    <!-- Step 1: User Query -->
    <rect x="70" y="160" width="140" height="50" rx="6" fill="url(#userGrad)" filter="url(#glow)"/>
    <text x="140" y="182" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="11" font-weight="bold">User Query</text>
    <text x="140" y="198" text-anchor="middle" fill="#c6f6d5" font-family="Arial, sans-serif" font-size="9">"Show AWS costs"</text>
    
    <line x1="210" y1="185" x2="260" y2="185" stroke="#48bb78" stroke-width="2" marker-end="url(#arrowGreen)"/>
    
    <!-- Step 2: RunStarted -->
    <rect x="280" y="160" width="140" height="50" rx="6" fill="#4a5568"/>
    <text x="350" y="180" text-anchor="middle" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="10" font-weight="bold">1. RunStarted</text>
    <text x="350" y="196" text-anchor="middle" fill="#a0aec0" font-family="Arial, sans-serif" font-size="8">runId, threadId</text>
    
    <line x1="420" y1="185" x2="470" y2="185" stroke="#a0aec0" stroke-width="2" marker-end="url(#arrow)"/>
    
    <!-- Step 3: Intent Classification -->
    <rect x="490" y="160" width="140" height="50" rx="6" fill="url(#agentGrad)"/>
    <text x="560" y="180" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Intent Classify</text>
    <text x="560" y="196" text-anchor="middle" fill="#d6bcfa" font-family="Arial, sans-serif" font-size="8">‚Üí COST_QUERY</text>
    
    <!-- Step 4: TextMessageStart -->
    <rect x="280" y="230" width="140" height="50" rx="6" fill="#4a5568"/>
    <text x="350" y="250" text-anchor="middle" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="10" font-weight="bold">2. TextMessageStart</text>
    <text x="350" y="266" text-anchor="middle" fill="#a0aec0" font-family="Arial, sans-serif" font-size="8">role: assistant</text>
    
    <line x1="350" y1="210" x2="350" y2="230" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4,2"/>
    
    <!-- Stream to UI -->
    <line x1="280" y1="255" x2="210" y2="255" stroke="#ed8936" stroke-width="2" marker-end="url(#arrowOrange)"/>
    <rect x="70" y="240" width="140" height="35" rx="4" fill="url(#uiGrad)" fill-opacity="0.8"/>
    <text x="140" y="262" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="9">"Analyzing AWS..."</text>
    
    <!-- Step 5: Route to Cost Agent -->
    <line x1="560" y1="210" x2="560" y2="290" stroke="#9f7aea" stroke-width="1.5" stroke-dasharray="4,2"/>
    <line x1="560" y1="290" x2="680" y2="290" stroke="#9f7aea" stroke-width="2" marker-end="url(#arrowPurple)"/>
    
    <rect x="700" y="270" width="140" height="50" rx="6" fill="#805ad5"/>
    <text x="770" y="290" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">üí∞ Cost Agent</text>
    <text x="770" y="306" text-anchor="middle" fill="#e9d8fd" font-family="Arial, sans-serif" font-size="8">Activated</text>
    
    <!-- Step 6: ToolCallStart -->
    <rect x="280" y="300" width="140" height="50" rx="6" fill="#4a5568"/>
    <text x="350" y="318" text-anchor="middle" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="10" font-weight="bold">3. ToolCallStart</text>
    <text x="350" y="334" text-anchor="middle" fill="#a0aec0" font-family="Arial, sans-serif" font-size="8">get_aws_cost_and_usage</text>
    
    <line x1="350" y1="280" x2="350" y2="300" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4,2"/>
    
    <!-- Stream tool call to UI -->
    <line x1="280" y1="325" x2="210" y2="325" stroke="#ed8936" stroke-width="2" marker-end="url(#arrowOrange)"/>
    <rect x="70" y="310" width="140" height="35" rx="4" fill="#2d3748" stroke="#63b3ed" stroke-width="1"/>
    <text x="140" y="332" text-anchor="middle" fill="#90cdf4" font-family="Arial, sans-serif" font-size="9">üîß Calling AWS API...</text>
    
    <!-- Step 7: MCP Call -->
    <line x1="840" y1="295" x2="890" y2="295" stroke="#63b3ed" stroke-width="2" marker-end="url(#arrowBlue)"/>
    
    <rect x="910" y="270" width="140" height="50" rx="6" fill="url(#mcpGrad)"/>
    <text x="980" y="290" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">AWS MCP</text>
    <text x="980" y="306" text-anchor="middle" fill="#bee3f8" font-family="Arial, sans-serif" font-size="8">Cost Explorer API</text>
    
    <!-- Step 8: MCP Response -->
    <line x1="910" y1="330" x2="840" y2="370" stroke="#63b3ed" stroke-width="2" stroke-dasharray="4,2"/>
    
    <rect x="700" y="350" width="140" height="50" rx="6" fill="#805ad5" fill-opacity="0.7"/>
    <text x="770" y="370" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Process Data</text>
    <text x="770" y="386" text-anchor="middle" fill="#e9d8fd" font-family="Arial, sans-serif" font-size="8">$45,230 total</text>
    
    <!-- Step 9: ToolCallEnd -->
    <rect x="280" y="370" width="140" height="50" rx="6" fill="#4a5568"/>
    <text x="350" y="388" text-anchor="middle" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="10" font-weight="bold">4. ToolCallEnd</text>
    <text x="350" y="404" text-anchor="middle" fill="#a0aec0" font-family="Arial, sans-serif" font-size="8">result: {costs...}</text>
    
    <line x1="350" y1="350" x2="350" y2="370" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4,2"/>
    <line x1="700" y1="375" x2="420" y2="395" stroke="#9f7aea" stroke-width="1.5" stroke-dasharray="4,2"/>
    
    <!-- Step 10: StateSnapshot (A2UI Component) -->
    <rect x="280" y="440" width="140" height="60" rx="6" fill="#ed8936"/>
    <text x="350" y="460" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">5. StateSnapshot</text>
    <text x="350" y="476" text-anchor="middle" fill="#feebc8" font-family="Arial, sans-serif" font-size="8">A2UI: CostSummaryCard</text>
    <text x="350" y="490" text-anchor="middle" fill="#feebc8" font-family="Arial, sans-serif" font-size="8">{totalCost: 45230}</text>
    
    <line x1="350" y1="420" x2="350" y2="440" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4,2"/>
    
    <!-- Render A2UI Component -->
    <line x1="280" y1="470" x2="210" y2="470" stroke="#ed8936" stroke-width="2" marker-end="url(#arrowOrange)"/>
    
    <rect x="60" y="430" width="160" height="90" rx="6" fill="#1a202c" stroke="#ed8936" stroke-width="2"/>
    <text x="140" y="452" text-anchor="middle" fill="#ed8936" font-family="Arial, sans-serif" font-size="10" font-weight="bold">CostSummaryCard</text>
    <rect x="75" y="460" width="130" height="50" rx="4" fill="#2d3748"/>
    <text x="140" y="478" text-anchor="middle" fill="#48bb78" font-family="Arial, sans-serif" font-size="16" font-weight="bold">$45,230</text>
    <text x="140" y="495" text-anchor="middle" fill="#fc8181" font-family="Arial, sans-serif" font-size="9">‚Üë 12.3% vs last month</text>
    
    <!-- Step 11: Second tool call for recommendations -->
    <rect x="490" y="440" width="140" height="50" rx="6" fill="url(#agentGrad)"/>
    <text x="560" y="460" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Route Next</text>
    <text x="560" y="476" text-anchor="middle" fill="#d6bcfa" font-family="Arial, sans-serif" font-size="8">‚Üí Optimization Agent</text>
    
    <line x1="560" y1="400" x2="560" y2="440" stroke="#9f7aea" stroke-width="1.5" stroke-dasharray="4,2"/>
    <line x1="630" y1="465" x2="680" y2="465" stroke="#9f7aea" stroke-width="2" marker-end="url(#arrowPurple)"/>
    
    <rect x="700" y="440" width="140" height="50" rx="6" fill="#805ad5"/>
    <text x="770" y="460" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">‚ö° Optimization</text>
    <text x="770" y="476" text-anchor="middle" fill="#e9d8fd" font-family="Arial, sans-serif" font-size="8">Activated</text>
    
    <!-- MCP call for recommendations -->
    <line x1="840" y1="465" x2="890" y2="465" stroke="#63b3ed" stroke-width="2" marker-end="url(#arrowBlue)"/>
    
    <rect x="910" y="440" width="140" height="50" rx="6" fill="url(#mcpGrad)"/>
    <text x="980" y="460" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">AWS MCP</text>
    <text x="980" y="476" text-anchor="middle" fill="#bee3f8" font-family="Arial, sans-serif" font-size="8">Compute Optimizer</text>
    
    <!-- Step 12: Second StateSnapshot -->
    <rect x="280" y="530" width="140" height="60" rx="6" fill="#ed8936"/>
    <text x="350" y="550" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">6. StateSnapshot</text>
    <text x="350" y="566" text-anchor="middle" fill="#feebc8" font-family="Arial, sans-serif" font-size="8">A2UI: RecommendList</text>
    <text x="350" y="580" text-anchor="middle" fill="#feebc8" font-family="Arial, sans-serif" font-size="8">{savings: 2340}</text>
    
    <line x1="350" y1="500" x2="350" y2="530" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4,2"/>
    
    <!-- Render Recommendations -->
    <line x1="280" y1="560" x2="210" y2="560" stroke="#ed8936" stroke-width="2" marker-end="url(#arrowOrange)"/>
    
    <rect x="60" y="530" width="160" height="100" rx="6" fill="#1a202c" stroke="#ed8936" stroke-width="2"/>
    <text x="140" y="552" text-anchor="middle" fill="#ed8936" font-family="Arial, sans-serif" font-size="10" font-weight="bold">RecommendationList</text>
    <rect x="75" y="560" width="130" height="60" rx="4" fill="#2d3748"/>
    <text x="85" y="578" fill="#48bb78" font-family="Arial, sans-serif" font-size="9">üí° Rightsize i-abc123</text>
    <text x="85" y="593" fill="#a0aec0" font-family="Arial, sans-serif" font-size="8">   Save $450/mo</text>
    <text x="85" y="608" fill="#48bb78" font-family="Arial, sans-serif" font-size="9">üí° Delete unused EBS</text>
    
    <!-- Step 13: TextMessageEnd -->
    <rect x="280" y="650" width="140" height="50" rx="6" fill="#4a5568"/>
    <text x="350" y="668" text-anchor="middle" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="10" font-weight="bold">7. TextMessageEnd</text>
    <text x="350" y="684" text-anchor="middle" fill="#a0aec0" font-family="Arial, sans-serif" font-size="8">Final summary text</text>
    
    <line x1="350" y1="590" x2="350" y2="650" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4,2"/>
    
    <!-- Final text to UI -->
    <line x1="280" y1="675" x2="210" y2="675" stroke="#ed8936" stroke-width="2" marker-end="url(#arrowOrange)"/>
    <rect x="60" y="650" width="160" height="50" rx="4" fill="#2d3748" stroke="#718096" stroke-width="1"/>
    <text x="140" y="672" text-anchor="middle" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="9">"Your AWS costs this</text>
    <text x="140" y="686" text-anchor="middle" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="9">month are $45,230..."</text>
    
    <!-- Step 14: RunFinished -->
    <rect x="280" y="720" width="140" height="50" rx="6" fill="#276749"/>
    <text x="350" y="740" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="10" font-weight="bold">8. RunFinished</text>
    <text x="350" y="756" text-anchor="middle" fill="#9ae6b4" font-family="Arial, sans-serif" font-size="8">status: completed</text>
    
    <line x1="350" y1="700" x2="350" y2="720" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4,2"/>
    
    <!-- Completion indicator -->
    <line x1="280" y1="745" x2="210" y2="745" stroke="#48bb78" stroke-width="2" marker-end="url(#arrowGreen)"/>
    <rect x="60" y="720" width="160" height="50" rx="6" fill="url(#userGrad)" fill-opacity="0.5" stroke="#48bb78" stroke-width="2"/>
    <text x="140" y="745" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="11" font-weight="bold">‚úì Complete</text>
    <text x="140" y="760" text-anchor="middle" fill="#c6f6d5" font-family="Arial, sans-serif" font-size="9">Interactive UI ready</text>
  </g>
  
  <!-- Legend -->
  <g id="legend" transform="translate(60, 800)">
    <rect x="0" y="0" width="1080" height="60" rx="6" fill="#1a202c" stroke="#4a5568"/>
    <text x="20" y="20" fill="#e2e8f0" font-family="Arial, sans-serif" font-size="11" font-weight="bold">EVENT TYPES:</text>
    
    <rect x="20" y="30" width="12" height="12" fill="#4a5568"/>
    <text x="40" y="40" fill="#a0aec0" font-family="Arial, sans-serif" font-size="10">Control Events</text>
    
    <rect x="150" y="30" width="12" height="12" fill="#ed8936"/>
    <text x="170" y="40" fill="#a0aec0" font-family="Arial, sans-serif" font-size="10">A2UI Components</text>
    
    <rect x="300" y="30" width="12" height="12" fill="#805ad5"/>
    <text x="320" y="40" fill="#a0aec0" font-family="Arial, sans-serif" font-size="10">Agent Processing</text>
    
    <rect x="450" y="30" width="12" height="12" fill="#3182ce"/>
    <text x="470" y="40" fill="#a0aec0" font-family="Arial, sans-serif" font-size="10">MCP Calls</text>
    
    <rect x="580" y="30" width="12" height="12" fill="#38a169"/>
    <text x="600" y="40" fill="#a0aec0" font-family="Arial, sans-serif" font-size="10">User Interaction</text>
    
    <text x="750" y="20" fill="#718096" font-family="Arial, sans-serif" font-size="10">PROTOCOL:</text>
    <text x="750" y="40" fill="#a0aec0" font-family="Arial, sans-serif" font-size="10">SSE (Server-Sent Events) for real-time streaming</text>
    
    <text x="980" y="30" fill="#ed8936" font-family="Arial, sans-serif" font-size="10" font-weight="bold">‚Üí A2UI</text>
    <text x="980" y="45" fill="#718096" font-family="Arial, sans-serif" font-size="9">Agent-to-UI</text>
  </g>
  
</svg>
